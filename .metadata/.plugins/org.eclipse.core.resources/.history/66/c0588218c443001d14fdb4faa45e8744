package com.example.spring02.util;

import java.io.File;
import java.util.UUID;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.util.FileCopyUtils;

public class UploadFileUtils {
	//로깅
	private static final Logger logger=
			LoggerFactory.getLogger(UploadFileUtils.class);
	public static String uploadFile(String uploadPath,String originalName, byte[] fileData) throws Exception{
		//uuid발금
		UUID uid = UUID.randomUUID();//랜덤 난수 발행
		String savedName= uid.toString()+"_"+originalName;
		//업로드할 디렉토리생성
		String savedPath=calcPath(uploadPath);
		File target=new File(uploadPath+savedPath, savedName);
		//임시디렉토리에 업로드된 파일을 지정된 디렉토리로 복사
		FileCopyUtils.copy(fileData, target);
		//파일의 확장자 검사
		//aaa.bbb.ccc.jpg 같이 들어온 경우 맨 끝의 . 뒤가 확장자
		String formatName=originalName.substring(originalName.lastIndexOf(".")+1);
		String uploadedFileName=null;
		//이미지 파일인 경우 : 썸네일(작은이미지)생성
		if(MediaUtils.getMediaType(formatName)!= null) {
			//썸네일 생성
			uploadedFileName=makeThumbnail(uploadPath, savedPath, savedName);
		}else {//이미지파일이 아닌경우
			uploadedFileName=makeIcon(uploadPath, savedPath, savedName);
			
		}
	}
}
